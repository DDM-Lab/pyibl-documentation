<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Rock paper scissors game example &#8212; PyIBL 5.2.1dev1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=a66d8bb5" />
    <script src="_static/documentation_options.js?v=b4878324"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multi-agent network example" href="multi-agent-network.html" />
    <link rel="prev" title="Binary choice example" href="binary-choice.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/pyibl.png" alt="Logo" />
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internals</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="binary-choice.html">Binary choice example</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Rock paper scissors game example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#random-model">Random model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#win-stay-lose-shift-model">Win stay lose shift model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ibl-models">IBL models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="multi-agent-network.html">Multi-agent network example</a></li>
<li class="toctree-l2"><a class="reference internal" href="insider-attack.html">Insider attack example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Changes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="examples.html">Examples</a><ul>
      <li>Previous: <a href="binary-choice.html" title="previous chapter">Binary choice example</a></li>
      <li>Next: <a href="multi-agent-network.html" title="next chapter">Multi-agent network example</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="rock-paper-scissors-game-example">
<h1>Rock paper scissors game example<a class="headerlink" href="#rock-paper-scissors-game-example" title="Link to this heading">¶</a></h1>
<p>Here is described a Python implementation of the Rock, Paper, Scissors game <a class="footnote-reference brackets" href="#f2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, and how to
connect a variety of models to it. Rock, Paper, Scissors is a game where two players
compete, each choosing one of three possible moves. It is most interesting when
iterated many times, as players may possibly be able to learn about their opponent’s
biases and exploit them. Note that there are three outcomes possible in any round, two where one
player wins and the other loses, and a third where the players tie. This can have implications for
strategies, as, for example, maximizing a player’s numbers wins is not the same as minimizing that player’s number of loses.
The game has been extensively studied.</p>
<p><a class="reference download internal" download="" href="_downloads/0d667b846b18a3f3e76b7fa6d9e216c4/rps.zip"><code class="xref download docutils literal notranslate"><span class="pre">Click</span> <span class="pre">here</span> <span class="pre">to</span> <span class="pre">download</span></code></a> a zipped archive for the various files of code
described in this section, along with a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file. The recommended way of running these
examples yourself is to create and activate a virtual environment using venv or conda, doing <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code> in
it, and then in it running Python on the desired file.</p>
<p>The implementation of the game, which is completely independent of PyIBL,  is in <code class="docutils literal notranslate"><span class="pre">rps-game.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Copyright 2024 Carnegie Mellon University</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  4</span><span class="sd">A framework for placing the Rock, Paper, Scissors game. Players instances of subclasses</span>
<span class="linenos">  5</span><span class="sd">of RPSPlayer.</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="sd">Also included is a command line interface to run pairs of players, typically of two</span>
<span class="linenos">  8</span><span class="sd">different types, against one another for a given number of rounds and a number of</span>
<span class="linenos">  9</span><span class="sd">virtual participant pairs. The players are described as a module name, dot, and a</span>
<span class="linenos"> 10</span><span class="sd">constructor name, optionally followed by parenthesized arguments to the constructor. For</span>
<span class="linenos"> 11</span><span class="sd">example,</span>
<span class="linenos"> 12</span><span class="sd">    python rps_game.py wsls.WinStayLoseShiftPlayer &quot;rand.RandomPlayer(bias=(0.8, 0.1))&quot;</span>
<span class="linenos"> 13</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="kn">import</span> <span class="nn">click</span>
<span class="linenos"> 16</span><span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
<span class="linenos"> 17</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="linenos"> 18</span><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="linenos"> 19</span><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">splitext</span>
<span class="linenos"> 20</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="linenos"> 21</span><span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">fullmatch</span>
<span class="linenos"> 22</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 23</span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">trange</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="n">MOVES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rock&quot;</span><span class="p">,</span> <span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="s2">&quot;scissors&quot;</span><span class="p">]</span>
<span class="linenos"> 27</span><span class="n">RESULTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tie&quot;</span><span class="p">,</span> <span class="s2">&quot;win&quot;</span><span class="p">,</span> <span class="s2">&quot;lose&quot;</span><span class="p">]</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="k">class</span> <span class="nc">RPSPlayer</span><span class="p">:</span>
<span class="linenos"> 31</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 32</span><span class="sd">    Subclass this abstract class to create a kind of player. The move() method must</span>
<span class="linenos"> 33</span><span class="sd">    be overridden to respond with one of the possible MOVES. If desired, the result()</span>
<span class="linenos"> 34</span><span class="sd">    method may also be overridden to inform the player of the result of the most recent</span>
<span class="linenos"> 35</span><span class="sd">    round of play. Similarly the reset() method may be overridden; it is typically</span>
<span class="linenos"> 36</span><span class="sd">    called between virtual games to reset the virtual participant if that participant</span>
<span class="linenos"> 37</span><span class="sd">    retains state between rounds.</span>
<span class="linenos"> 38</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 41</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_awaiting_result</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 44</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;If there&#39;s anything to do this method must be overridden&quot;&quot;&quot;</span>
<span class="linenos"> 45</span>        <span class="k">pass</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span>    <span class="k">def</span> <span class="nf">do_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 48</span>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos"> 49</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_awaiting_result</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 52</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Must be overriden by a subclass&quot;&quot;&quot;</span>
<span class="linenos"> 53</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The move() method must be overridden&quot;</span><span class="p">)</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span>    <span class="k">def</span> <span class="nf">do_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 56</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_awaiting_result</span><span class="p">:</span>
<span class="linenos"> 57</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Cannot make a move until the previous round has been resolved&quot;</span><span class="p">)</span>
<span class="linenos"> 58</span>        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">()</span>
<span class="linenos"> 59</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_awaiting_result</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 60</span>        <span class="k">return</span> <span class="n">m</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span>    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent_move</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="n">ties</span><span class="p">,</span> <span class="n">losses</span><span class="p">):</span>
<span class="linenos"> 63</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;If there&#39;s anything to do this method must be overridden&quot;&quot;&quot;</span>
<span class="linenos"> 64</span>        <span class="k">pass</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span>    <span class="k">def</span> <span class="nf">do_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent_move</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="n">ties</span><span class="p">,</span> <span class="n">losses</span><span class="p">):</span>
<span class="linenos"> 67</span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_awaiting_result</span><span class="p">:</span>
<span class="linenos"> 68</span>            <span class="k">return</span>
<span class="linenos"> 69</span>        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">opponent_move</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="n">ties</span><span class="p">,</span> <span class="n">losses</span><span class="p">)</span>
<span class="linenos"> 70</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_awaiting_result</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="k">class</span> <span class="nc">RPSGame</span><span class="p">:</span>
<span class="linenos"> 75</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 76</span><span class="sd">    Plays one or more games between two player objects, each of a given number of rounds.</span>
<span class="linenos"> 77</span><span class="sd">    The player objects are reset between games. Returns a Pandas DataFrame collecting</span>
<span class="linenos"> 78</span><span class="sd">    the results of all the rounds of all the games.</span>
<span class="linenos"> 79</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player1</span><span class="p">,</span> <span class="n">player2</span><span class="p">,</span> <span class="n">rounds</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos"> 82</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_players</span> <span class="o">=</span> <span class="p">[</span><span class="n">player1</span><span class="p">,</span> <span class="n">player2</span><span class="p">]</span>
<span class="linenos"> 83</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_rounds</span> <span class="o">=</span> <span class="n">rounds</span>
<span class="linenos"> 84</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_participants</span> <span class="o">=</span> <span class="n">participants</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span>    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="linenos"> 87</span>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 88</span>        <span class="k">for</span> <span class="n">participant</span> <span class="ow">in</span> <span class="p">(</span><span class="n">trange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_participants</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">show_progress</span>
<span class="linenos"> 89</span>                            <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_participants</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
<span class="linenos"> 90</span>            <span class="n">wins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 91</span>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_players</span><span class="p">:</span>
<span class="linenos"> 92</span>                <span class="n">p</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos"> 93</span>            <span class="k">for</span> <span class="nb">round</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rounds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos"> 94</span>                <span class="n">moves</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">do_move</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_players</span><span class="p">]</span>
<span class="linenos"> 95</span>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">[</span><span class="n">RESULTS</span><span class="p">[(</span><span class="n">MOVES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">moves</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">MOVES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">moves</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]))</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span>
<span class="linenos"> 96</span>                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<span class="linenos"> 97</span>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
<span class="linenos"> 98</span>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;win&quot;</span><span class="p">:</span>
<span class="linenos"> 99</span>                        <span class="n">wins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">100</span>                <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">om</span><span class="p">,</span> <span class="n">oc</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">loss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_players</span><span class="p">,</span>
<span class="linenos">101</span>                                                <span class="nb">reversed</span><span class="p">(</span><span class="n">moves</span><span class="p">),</span>
<span class="linenos">102</span>                                                <span class="n">outcomes</span><span class="p">,</span>
<span class="linenos">103</span>                                                <span class="n">wins</span><span class="p">,</span>
<span class="linenos">104</span>                                                <span class="nb">reversed</span><span class="p">(</span><span class="n">wins</span><span class="p">)):</span>
<span class="linenos">105</span>                    <span class="n">p</span><span class="o">.</span><span class="n">do_result</span><span class="p">(</span><span class="n">om</span><span class="p">,</span> <span class="n">oc</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="nb">round</span> <span class="o">-</span> <span class="p">(</span><span class="n">win</span> <span class="o">+</span> <span class="n">loss</span><span class="p">),</span> <span class="n">loss</span><span class="p">)</span>
<span class="linenos">106</span>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">participant</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span>
<span class="linenos">107</span>                                <span class="n">moves</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moves</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="linenos">108</span>                                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="linenos">109</span>                                <span class="n">wins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wins</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="linenos">110</span>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span>
<span class="linenos">111</span>                            <span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;participant pair,round,&quot;</span>
<span class="linenos">112</span>                                     <span class="s2">&quot;player 1 move,player 2 move,&quot;</span>
<span class="linenos">113</span>                                     <span class="s2">&quot;player 1 outcome,player 2 outcome,&quot;</span>
<span class="linenos">114</span>                                     <span class="s2">&quot;player 1 total wins,player 2 total wins&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="linenos">115</span>
<span class="linenos">116</span>
<span class="linenos">117</span><span class="k">def</span> <span class="nf">plot_wins_losses</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">player_no</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">118</span>    <span class="k">if</span> <span class="n">file</span><span class="p">:</span>
<span class="linenos">119</span>        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="linenos">120</span>    <span class="n">other_player</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">player_no</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="mi">2</span>
<span class="linenos">121</span>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;wins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;player </span><span class="si">{</span><span class="n">player_no</span><span class="si">}</span><span class="s2"> total wins&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">122</span>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;player </span><span class="si">{</span><span class="n">other_player</span><span class="si">}</span><span class="s2"> total wins&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">123</span>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ties&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;wins&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">])</span>
<span class="linenos">124</span>    <span class="n">rounds</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">])</span>
<span class="linenos">125</span>    <span class="n">xmargin</span> <span class="o">=</span> <span class="n">rounds</span> <span class="o">/</span> <span class="mi">80</span>
<span class="linenos">126</span>    <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">)[[</span><span class="s2">&quot;wins&quot;</span><span class="p">,</span> <span class="s2">&quot;ties&quot;</span><span class="p">,</span> <span class="s2">&quot;losses&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<span class="linenos">127</span>                                                                <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="s2">&quot;firebrick&quot;</span><span class="p">),</span>
<span class="linenos">128</span>                                                                <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">),</span>
<span class="linenos">129</span>                                                                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<span class="linenos">130</span>                                                                <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
<span class="linenos">131</span>                                                                <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xmargin</span><span class="p">,</span> <span class="n">rounds</span> <span class="o">+</span> <span class="n">xmargin</span><span class="p">),</span>
<span class="linenos">132</span>                                                                <span class="n">xticks</span><span class="o">=</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rounds</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">rounds</span> <span class="o">&lt;</span> <span class="mi">8</span>
<span class="linenos">133</span>                                                                        <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
<span class="linenos">134</span>                                                                <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;fraction winning/losing&quot;</span><span class="p">)</span>
<span class="linenos">135</span>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">136</span>
<span class="linenos">137</span>
<span class="linenos">138</span><span class="k">def</span> <span class="nf">make_player</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="linenos">139</span>    <span class="k">if</span> <span class="n">m</span> <span class="o">:=</span> <span class="n">fullmatch</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w+)\.(\w+)(\(.*\))?&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="linenos">140</span>        <span class="n">mname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">141</span>        <span class="n">cname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">142</span>        <span class="n">args</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="linenos">143</span>        <span class="n">module</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">mname</span><span class="p">)</span>
<span class="linenos">144</span>        <span class="n">c</span> <span class="o">=</span> <span class="n">cname</span> <span class="o">+</span> <span class="p">(</span><span class="n">args</span> <span class="ow">or</span> <span class="s2">&quot;()&quot;</span><span class="p">)</span>
<span class="linenos">145</span>        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;module.</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">c</span>
<span class="linenos">146</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">147</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Don&#39;t know how to create player </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">148</span>
<span class="linenos">149</span><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="linenos">150</span><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--rounds&quot;</span><span class="p">,</span> <span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="linenos">151</span>              <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The number of rounds to play&quot;</span><span class="p">)</span>
<span class="linenos">152</span><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--participants&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
<span class="linenos">153</span>              <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The number of participant pairs to play&quot;</span><span class="p">)</span>
<span class="linenos">154</span><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--file&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos">155</span>              <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A CSV file into which to write the results&quot;</span><span class="p">)</span>
<span class="linenos">156</span><span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;player1&quot;</span><span class="p">)</span>
<span class="linenos">157</span><span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;player2&quot;</span><span class="p">)</span>
<span class="linenos">158</span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">player1</span><span class="p">,</span> <span class="n">player2</span><span class="p">,</span> <span class="n">rounds</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">159</span>    <span class="k">if</span> <span class="n">file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
<span class="linenos">160</span>        <span class="n">file</span> <span class="o">+=</span> <span class="s2">&quot;.csv&quot;</span>
<span class="linenos">161</span>    <span class="k">if</span> <span class="n">show_progress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">162</span>        <span class="n">show_progress</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">player1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;human&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">player2</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;human&quot;</span><span class="p">)</span>
<span class="linenos">163</span>    <span class="n">p1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">make_player</span><span class="p">(</span><span class="n">player1</span><span class="p">)</span>
<span class="linenos">164</span>    <span class="n">p2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">make_player</span><span class="p">(</span><span class="n">player2</span><span class="p">)</span>
<span class="linenos">165</span>    <span class="n">plot_wins_losses</span><span class="p">(</span><span class="n">RPSGame</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">rounds</span><span class="p">,</span> <span class="n">participants</span><span class="p">)</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">show_progress</span><span class="p">),</span>
<span class="linenos">166</span>                     <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s2"> versus</span><span class="se">\n</span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="se">\n</span><span class="s2">(averaged over </span><span class="si">{</span><span class="n">participants</span><span class="si">}</span><span class="s2"> participants)&quot;</span><span class="p">,</span>
<span class="linenos">167</span>                     <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
<span class="linenos">168</span>
<span class="linenos">169</span>
<span class="linenos">170</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">171</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>This defines a class, <code class="docutils literal notranslate"><span class="pre">RPSPlayer</span></code>, which is
subclassed to implement various player types.
There is a further <code class="docutils literal notranslate"><span class="pre">RPSGame</span></code> class which is constructed with two players which are
subclasses of <code class="docutils literal notranslate"><span class="pre">RPSPlayer</span></code>;
the two players are typically, though not necessarily, of different subclasses.
The <code class="docutils literal notranslate"><span class="pre">RPSGame</span></code> object calls the players repeatedly for a number of rounds,
typically for several or many  virtual participant pairs, and gathers the results,
returning them as a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html">Pandas DataFrame</a>
The <code class="docutils literal notranslate"><span class="pre">rps_game.py</span></code> file also contains a function, <code class="docutils literal notranslate"><span class="pre">plot_winsₗosses</span></code> that takes such a DataFrame and plots
the wins and losses of the first player against the second using the <a class="reference external" href="https://matplotlib.org/">Matplotlib</a> library.</p>
<p>When creating a subclass of <code class="docutils literal notranslate"><span class="pre">RPSPlayer</span></code>
its <code class="docutils literal notranslate"><span class="pre">move()</span></code> method must be overridden to return one of the string values <code class="docutils literal notranslate"><span class="pre">&quot;rock&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;paper&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;scissors&quot;</span></code>.
Usually the method <code class="docutils literal notranslate"><span class="pre">result()</span></code> is also overridden, allowing display or capture
of the results of a round of the game, though for some very simple models this may not be necessary.
Similarly the <code class="docutils literal notranslate"><span class="pre">reset()</span></code> method may be overridden if the model is retaining state carried from round to round that
may need to be reset between virtual participants.
A simple human player is defined with the subclass <code class="docutils literal notranslate"><span class="pre">HumanPlayer</span></code> in <code class="docutils literal notranslate"><span class="pre">human.py</span></code>;
note that the <code class="docutils literal notranslate"><span class="pre">HuamnPlayer</span></code> overrides <code class="docutils literal notranslate"><span class="pre">move()</span></code> to request a move from the player and returns it; and
overrides <code class="docutils literal notranslate"><span class="pre">result()</span></code> to display the results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Copyright 2024 Carnegie Mellon University</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 4</span><span class="sd">An RPSPlayer subclass which simply solicits moves from a human player using the terminal,</span>
<span class="linenos"> 5</span><span class="sd">and also prints to the terminal the results of each round of play.</span>
<span class="linenos"> 6</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="kn">from</span> <span class="nn">rps_game</span> <span class="kn">import</span> <span class="n">RPSPlayer</span><span class="p">,</span> <span class="n">MOVES</span>
<span class="linenos"> 9</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="k">def</span> <span class="nf">read_move</span><span class="p">():</span>
<span class="linenos">12</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">13</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enter your next move: r(ock), p(aper) or s(cissors): &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">14</span>        <span class="n">s</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="linenos">15</span>        <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
<span class="linenos">16</span>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">MOVES</span><span class="p">:</span>
<span class="linenos">17</span>                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="linenos">18</span>                    <span class="k">return</span> <span class="n">m</span>
<span class="linenos">19</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="k">class</span> <span class="nc">HumanPlayer</span><span class="p">(</span><span class="n">RPSPlayer</span><span class="p">):</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">24</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_move</span> <span class="o">=</span> <span class="n">read_move</span><span class="p">()</span>
<span class="linenos">25</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_move</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent_move</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="n">ties</span><span class="p">,</span> <span class="n">losses</span><span class="p">):</span>
<span class="linenos">28</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You played </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_move</span><span class="si">}</span><span class="s2">, your opponent played </span><span class="si">{</span><span class="n">opponent_move</span><span class="si">}</span><span class="s2">, you </span><span class="si">{</span><span class="n">outcome</span><span class="si">}</span><span class="s2"> &quot;</span>
<span class="linenos">29</span>              <span class="sa">f</span><span class="s2">&quot;(so far you have won </span><span class="si">{</span><span class="n">wins</span><span class="si">}</span><span class="s2">, tied </span><span class="si">{</span><span class="n">ties</span><span class="si">}</span><span class="s2"> and lost </span><span class="si">{</span><span class="n">losses</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>It would also be relatively straightforward to create a web-based interface as an <code class="docutils literal notranslate"><span class="pre">RPSPlayer</span></code>, which
would allow a human-human game to be played.</p>
<p>In addition to this human player, a number of models are implemented, several using PyIBL, and are described in subsequent subsections.</p>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">rps-game.py</span></code> implements a command line interface, creating an <code class="docutils literal notranslate"><span class="pre">RPSGame</span></code> with players of designated types,
playing potentially many rounds with many virtual pairs of those players, and then plotting the results of these games.
Because running large number of participants can require long periods of time, particularly for some kinds of models and/or
large numbers of rounds, a progress indicator is usually shown while results are being computed.
For example, to run 1,000 pairs of <code class="docutils literal notranslate"><span class="pre">WinStayLoseShiftPlayer</span></code> (described further below) against a <code class="docutils literal notranslate"><span class="pre">RandoomPlayer</span></code> (also described further below),
the latter biased to return rock 80% of the time, paper 20%, and scissors never, with each pair playing 60 rounds, you could call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">rps_game</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">participants</span><span class="o">=</span><span class="mi">1000</span> <span class="o">--</span><span class="n">rounds</span><span class="o">=</span><span class="mi">60</span> <span class="n">wsls</span><span class="o">.</span><span class="n">WinStayLoseShiftPlayer</span> <span class="s2">&quot;rand.RandomPlayer(bias=(0.8, 0.2))&quot;</span>
</pre></div>
</div>
<p>This will result in display of a graph much like the following, though it may differ
slightly in detail since both models are stochastic.</p>
<a class="reference internal image-reference" href="_images/rps-1.png"><img alt="_images/rps-1.png" src="_images/rps-1.png" style="width: 700px;" />
</a>
<p>By supplying a <code class="docutils literal notranslate"><span class="pre">--file</span></code> argument you can also save the resulting DataFrame describing the full results
into a CSV file. For example, if we add <code class="docutils literal notranslate"><span class="pre">--file=results.csv</span></code> the first few lines of the resulting file will look something
like the following, though again differing in detail since the models are stochastic.</p>
<blockquote>
<div><p>,participant pair,round,player 1 move,player 2 move,player 1 outcome,player 2 outcome,player 1 total wins,player 2 total wins
0,1,1,scissors,rock,lose,win,0,1
1,1,2,rock,rock,tie,tie,0,1
2,1,3,scissors,rock,lose,win,0,2
3,1,4,rock,rock,tie,tie,0,2
4,1,5,paper,rock,win,lose,1,2
5,1,6,paper,rock,win,lose,2,2
6,1,7,paper,rock,win,lose,3,2
7,1,8,paper,rock,win,lose,4,2
8,1,9,paper,rock,win,lose,5,2
9,1,10,paper,rock,win,lose,6,2
10,1,11,paper,rock,win,lose,7,2
11,1,12,paper,rock,win,lose,8,2
12,1,13,paper,rock,win,lose,9,2
13,1,14,paper,paper,tie,tie,9,2
…</p>
</div></blockquote>
<p>Or, when imported into a spreadsheet:</p>
<a class="reference internal image-reference" href="_images/rps-2.png"><img alt="_images/rps-2.png" src="_images/rps-2.png" style="width: 700px;" />
</a>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Dyson, B. J. <em>et al</em>. Negative outcomes evoke cyclic irrational decisions in Rock, Paper, Scissors.
<em>Sci. Rep</em>. 6, 20479; doi: 10.1038/srep20479 (2016).</p>
</aside>
</aside>
<section id="random-model">
<h2>Random model<a class="headerlink" href="#random-model" title="Link to this heading">¶</a></h2>
<p>Perhaps the simplest model, <code class="docutils literal notranslate"><span class="pre">RandomPlayer</span></code> in <code class="docutils literal notranslate"><span class="pre">rand.py</span></code>, simply chooses a move at random.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Copyright 2024 Carnegie Mellon University</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 4</span><span class="sd">A player who, by default, chooses moves uniformly at random. If bias is set it should</span>
<span class="linenos"> 5</span><span class="sd">be a 2-tuple, the probabilities of rock or paper being chosen, and a correspondingly</span>
<span class="linenos"> 6</span><span class="sd">skewed distribution is then used for picking moves at random.</span>
<span class="linenos"> 7</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">import</span> <span class="nn">random</span>
<span class="linenos">10</span><span class="kn">from</span> <span class="nn">rps_game</span> <span class="kn">import</span> <span class="n">RPSPlayer</span><span class="p">,</span> <span class="n">MOVES</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">class</span> <span class="nc">RandomPlayer</span><span class="p">(</span><span class="n">RPSPlayer</span><span class="p">):</span>
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">15</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">bias</span><span class="p">:</span>
<span class="linenos">17</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_rock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paper</span> <span class="o">=</span> <span class="n">bias</span>
<span class="linenos">18</span>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rock</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paper</span> <span class="o">&gt;=</span> <span class="mi">0</span>
<span class="linenos">19</span>                    <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rock</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paper</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos">20</span>                <span class="k">raise</span> <span class="n">RuntimError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bias (</span><span class="si">{</span><span class="n">bias</span><span class="si">}</span><span class="s2">) should be a tuple of the probabilities that rock and paper are chosen&quot;</span><span class="p">)</span>
<span class="linenos">21</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">22</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_rock</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">25</span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rock</span><span class="p">:</span>
<span class="linenos">26</span>            <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">MOVES</span><span class="p">)</span>
<span class="linenos">27</span>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="linenos">28</span>        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rock</span><span class="p">:</span>
<span class="linenos">29</span>            <span class="k">return</span> <span class="s2">&quot;rock&quot;</span>
<span class="linenos">30</span>        <span class="k">elif</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rock</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paper</span><span class="p">:</span>
<span class="linenos">31</span>            <span class="k">return</span> <span class="s2">&quot;paper&quot;</span>
<span class="linenos">32</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">33</span>            <span class="k">return</span> <span class="s2">&quot;scissors&quot;</span>
</pre></div>
</div>
<p>By default it uses a uniform random distribution to choose between the three moves.
While this is “optimal” play in the sense that no other player can exploit it to win more than one third
of the time, neither can the random player exploit other players’ biases.</p>
<p>If desired the distribution used to choose moves may be skewed by setting the <code class="docutils literal notranslate"><span class="pre">bias</span></code> parameter, which should
be a 2-tuple of the probabilities of choosing rock and paper. for example, to choose rock 80% of the time,
paper never, and scissors 20% of the time, <code class="docutils literal notranslate"><span class="pre">RandomPlayer(bias=(0.8,</span> <span class="pre">0)</span></code>.</p>
</section>
<section id="win-stay-lose-shift-model">
<h2>Win stay lose shift model<a class="headerlink" href="#win-stay-lose-shift-model" title="Link to this heading">¶</a></h2>
<p>A strategy that has been widely studied is Win Stay, Lose Shift, which is demonstrated here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Copyright 2024 Carnegie Mellon University</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 4</span><span class="sd">A player using a win stay, lose shift strategy. After a loss the next move is an upgrade</span>
<span class="linenos"> 5</span><span class="sd">of the previous one with probability upgrade, and otherwise a downgrade. The initial move</span>
<span class="linenos"> 6</span><span class="sd">is chosen randomly. Note that with the default upgrade value of 0.5 the shift after a</span>
<span class="linenos"> 7</span><span class="sd">is simply to a uniformly random choice between the other two moves.</span>
<span class="linenos"> 8</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">random</span>
<span class="linenos">11</span><span class="kn">from</span> <span class="nn">rps_game</span> <span class="kn">import</span> <span class="n">RPSPlayer</span><span class="p">,</span> <span class="n">MOVES</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="k">class</span> <span class="nc">WinStayLoseShiftPlayer</span><span class="p">(</span><span class="n">RPSPlayer</span><span class="p">):</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upgrade</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="linenos">16</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="linenos">17</span>        <span class="k">if</span> <span class="n">upgrade</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">upgrade</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">18</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the upgrade parameter (</span><span class="si">{</span><span class="n">updagrede</span><span class="si">}</span><span class="s2">)should be a probability, non-negative but less than one&quot;</span><span class="p">)</span>
<span class="linenos">19</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_upgrade</span> <span class="o">=</span> <span class="n">upgrade</span>
<span class="linenos">20</span>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_move</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">24</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_outcome</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">25</span>
<span class="linenos">26</span>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">27</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_outcome</span> <span class="o">==</span> <span class="s2">&quot;win&quot;</span><span class="p">:</span>
<span class="linenos">28</span>            <span class="n">mv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_move</span>
<span class="linenos">29</span>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_outcome</span><span class="p">:</span>
<span class="linenos">30</span>            <span class="n">mv</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">MOVES</span><span class="p">)</span>
<span class="linenos">31</span>        <span class="k">elif</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upgrade</span><span class="p">:</span>
<span class="linenos">32</span>            <span class="c1"># upgrade</span>
<span class="linenos">33</span>            <span class="n">mv</span> <span class="o">=</span> <span class="n">MOVES</span><span class="p">[(</span><span class="n">MOVES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_move</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span>
<span class="linenos">34</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">35</span>            <span class="c1"># downgrade</span>
<span class="linenos">36</span>            <span class="n">mv</span> <span class="o">=</span> <span class="n">MOVES</span><span class="p">[(</span><span class="n">MOVES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_move</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span>
<span class="linenos">37</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_move</span> <span class="o">=</span> <span class="n">mv</span>
<span class="linenos">38</span>        <span class="k">return</span> <span class="n">mv</span>
<span class="linenos">39</span>
<span class="linenos">40</span>    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent_move</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="n">ties</span><span class="p">,</span> <span class="n">losses</span><span class="p">):</span>
<span class="linenos">41</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_outcome</span> <span class="o">=</span> <span class="n">outcome</span>
</pre></div>
</div>
<p>When shifting after a loss a choice needs to be made between the two other possible moves. By default
this choice is made uniformly at random. However an upgrade or downgrade can be made preferred
by setting the <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> parameter to the probability that after a loss the next move is an upgrade
from this player’s previous move. Note that strategies where a loss is always followed by an upgrade
or a downgrade can easily be used simply by setting <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code>, respectively.</p>
<p>For example, to play a win stay, lose shift strategy, with a loss resulting in a 20%
chance of an upgrade and an 80% chance of a downgrade, against a biased random strategy favoring rock
80% of the time we could do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">rps_game</span><span class="o">.</span><span class="n">py</span> <span class="s2">&quot;wsls.WinStayLoseShiftPlayer(upgrade=0.2)&quot;</span> <span class="s2">&quot;rand.RandomPlayer(bias=(0.8, 0.15))&quot;</span>
</pre></div>
</div>
<p>This results in a plot similar to the following.</p>
<a class="reference internal image-reference" href="_images/rps-3.png"><img alt="_images/rps-3.png" src="_images/rps-3.png" style="width: 700px;" />
</a>
</section>
<section id="ibl-models">
<h2>IBL models<a class="headerlink" href="#ibl-models" title="Link to this heading">¶</a></h2>
<p>Neither of the above models have any dependence upon PyIBL, but we can easily create PyIBL models, too, which allow us to
see how various IBL models can fare playing Rock, Paper, Scissors. Three such models are in <code class="docutils literal notranslate"><span class="pre">ibl.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Copyright 2024 Carnegie Mellon University</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">pyibl</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">rps_game</span> <span class="kn">import</span> <span class="n">RPSPlayer</span><span class="p">,</span> <span class="n">MOVES</span><span class="p">,</span> <span class="n">RESULTS</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  9</span><span class="sd">Several different IBL models for playing Rock, Paper, Scissors.</span>
<span class="linenos"> 10</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="k">class</span> <span class="nc">IBLPlayer</span><span class="p">(</span><span class="n">RPSPlayer</span><span class="p">):</span>
<span class="linenos"> 13</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 14</span><span class="sd">    A base class for a players using a single PyIBL Agent. The attributes argument is</span>
<span class="linenos"> 15</span><span class="sd">    passed to the Agent constructor. The payoffs argument is a 3-tuple of the payoffs</span>
<span class="linenos"> 16</span><span class="sd">    for the possible results in the order lose, tie, win.</span>
<span class="linenos"> 17</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">payoffs</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">kwd</span><span class="o">=</span><span class="p">{}):</span>
<span class="linenos"> 20</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="linenos"> 21</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
<span class="linenos"> 22</span>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;noise&quot;</span><span class="p">,</span> <span class="s2">&quot;decay&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">):</span>
<span class="linenos"> 23</span>            <span class="k">if</span> <span class="n">v</span> <span class="o">:=</span> <span class="n">kwd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="linenos"> 24</span>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="linenos"> 25</span>        <span class="c1"># The _payoffs in the object are stored in a different order than the human</span>
<span class="linenos"> 26</span>        <span class="c1"># friendly order used for the parameter, instead matching he order in which</span>
<span class="linenos"> 27</span>        <span class="c1"># they appear in rps_game.RESULTS: tie, win, lose</span>
<span class="linenos"> 28</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_payoffs</span> <span class="o">=</span> <span class="n">payoffs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">payoffs</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos"> 29</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_payoff</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">payoffs</span><span class="p">)</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 32</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">default_utility</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>    <span class="k">def</span> <span class="nf">respond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">):</span>
<span class="linenos"> 35</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_payoffs</span><span class="p">[</span><span class="n">RESULTS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">outcome</span><span class="p">)])</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span><span class="k">class</span> <span class="nc">BasicIBLPlayer</span><span class="p">(</span><span class="n">IBLPlayer</span><span class="p">):</span>
<span class="linenos"> 39</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 40</span><span class="sd">    A simplistic IBL model that simply notes how well we do for each possible move. While</span>
<span class="linenos"> 41</span><span class="sd">    this might work against a not very smart opponent, say one that almost always picks</span>
<span class="linenos"> 42</span><span class="sd">    rock, against players that are learning and responding from the history of our moves</span>
<span class="linenos"> 43</span><span class="sd">    it is unlike to do well.</span>
<span class="linenos"> 44</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
<span class="linenos"> 47</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">kwd</span><span class="p">)</span>
<span class="linenos"> 48</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">default_utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_payoff</span>
<span class="linenos"> 49</span>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 52</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos"> 53</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 56</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">MOVES</span><span class="p">)</span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span>    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent_move</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="n">ties</span><span class="p">,</span> <span class="n">losses</span><span class="p">):</span>
<span class="linenos"> 59</span>        <span class="bp">self</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
<span class="linenos"> 60</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span><span class="k">class</span> <span class="nc">ContextualIBLPlayer</span><span class="p">(</span><span class="n">IBLPlayer</span><span class="p">):</span>
<span class="linenos"> 63</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 64</span><span class="sd">    A slightly smarter IBL model that chooses its move based on what move our opponent</span>
<span class="linenos"> 65</span><span class="sd">    made in the last round.</span>
<span class="linenos"> 66</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
<span class="linenos"> 69</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">([</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="s2">&quot;opponent_previous_mode&quot;</span><span class="p">],</span> <span class="n">kwd</span><span class="o">=</span><span class="n">kwd</span><span class="p">)</span>
<span class="linenos"> 70</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">default_utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_payoff</span>
<span class="linenos"> 71</span>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 74</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos"> 75</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_opponent_previous</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 78</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">MOVES</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_opponent_previous</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent_move</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="n">ties</span><span class="p">,</span> <span class="n">losses</span><span class="p">):</span>
<span class="linenos"> 81</span>        <span class="bp">self</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
<span class="linenos"> 82</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_opponent_previous</span> <span class="o">=</span> <span class="n">opponent_move</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span><span class="n">NONE_MATCH</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="k">def</span> <span class="nf">move_sim</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="linenos"> 88</span>    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
<span class="linenos"> 89</span>        <span class="k">return</span> <span class="mi">1</span>
<span class="linenos"> 90</span>    <span class="k">elif</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 91</span>        <span class="k">return</span> <span class="n">NONE_MATCH</span>
<span class="linenos"> 92</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 93</span>        <span class="k">return</span> <span class="mi">0</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span><span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<span class="linenos"> 96</span>    <span class="c1"># Adds element to the front of the list, shifting the existing elements towards the</span>
<span class="linenos"> 97</span>    <span class="c1"># back, with the oldest element falling off the end of the list.</span>
<span class="linenos"> 98</span>    <span class="nb">list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos"> 99</span>    <span class="nb">list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
<span class="linenos">100</span>
<span class="linenos">101</span>
<span class="linenos">102</span><span class="k">class</span> <span class="nc">LagIBLPlayer</span><span class="p">(</span><span class="n">IBLPlayer</span><span class="p">):</span>
<span class="linenos">103</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">104</span><span class="sd">    An IBL model that keeps track of the past N (= log) moves of both out opponent and</span>
<span class="linenos">105</span><span class="sd">    our own move, thus capturing how our opponent responds to our moves. Because there</span>
<span class="linenos">106</span><span class="sd">    are so many possibilities we use partial matching with not yet seen possibilities</span>
<span class="linenos">107</span><span class="sd">    viewed as half as salient as those that match perfectly.</span>
<span class="linenos">108</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">109</span>
<span class="linenos">110</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mismatch_penalty</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwd</span><span class="p">):</span>
<span class="linenos">111</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_lag</span> <span class="o">=</span> <span class="n">lag</span>
<span class="linenos">112</span>        <span class="n">move_attrs</span> <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;opp-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lag</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+</span>
<span class="linenos">113</span>                      <span class="p">[</span><span class="s2">&quot;own-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lag</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
<span class="linenos">114</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">([</span><span class="s2">&quot;move&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">move_attrs</span><span class="p">,</span> <span class="n">kwd</span><span class="o">=</span><span class="n">kwd</span><span class="p">)</span>
<span class="linenos">115</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">mismatch_penalty</span> <span class="o">=</span> <span class="n">mismatch_penalty</span>
<span class="linenos">116</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">similarity</span><span class="p">(</span><span class="n">move_attrs</span><span class="p">,</span> <span class="n">move_sim</span><span class="p">)</span>
<span class="linenos">117</span>        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos">118</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_payoff</span><span class="p">)</span>
<span class="linenos">119</span>
<span class="linenos">120</span>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">121</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_opp_prev</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lag</span>
<span class="linenos">122</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_own_prev</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lag</span>
<span class="linenos">123</span>
<span class="linenos">124</span>    <span class="k">def</span> <span class="nf">choices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">125</span>        <span class="k">return</span> <span class="p">[[</span><span class="n">move</span><span class="p">]</span> <span class="o">+</span> <span class="n">lst</span>
<span class="linenos">126</span>                <span class="k">for</span> <span class="n">move</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">MOVES</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_opp_prev</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_own_prev</span><span class="p">))]</span>
<span class="linenos">127</span>
<span class="linenos">128</span>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">129</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">130</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_move</span>
<span class="linenos">131</span>
<span class="linenos">132</span>    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent_move</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">wins</span><span class="p">,</span> <span class="n">ties</span><span class="p">,</span> <span class="n">losses</span><span class="p">):</span>
<span class="linenos">133</span>        <span class="bp">self</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
<span class="linenos">134</span>        <span class="n">shift</span><span class="p">(</span><span class="n">opponent_move</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_opp_prev</span><span class="p">)</span>
<span class="linenos">135</span>        <span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_move</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_own_prev</span><span class="p">)</span>
</pre></div>
</div>
<p>All three models use one PyIBL Agent for each player, and the code managing that agent is shared by having each model
a subclass of an base <code class="docutils literal notranslate"><span class="pre">IBLPlayer</span></code> class. What attributes the created Agent has is set with the <code class="docutils literal notranslate"><span class="pre">attributes</span></code> argument
to the <code class="docutils literal notranslate"><span class="pre">IBLPlayer</span></code> constructor. When making such an IBL model we must decide what the utilities are of
winning, losing or tying a game. By default <code class="docutils literal notranslate"><span class="pre">IBLPlayer</span></code> sets these to 1 point for a win, 0 points for a tie, and -1 points
for a loss. These values can be adjusted with the <code class="docutils literal notranslate"><span class="pre">payoffs</span></code> argument to the constructor. The default prefers winning, but
views tying as preferable to losing; but for some investigations it may be appropriate to aim solely at maximizing wins, or
minimizing losses, so <code class="docutils literal notranslate"><span class="pre">payoffs</span></code> something like <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></code> or <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">1,</span> <span class="pre">1)</span></code>, respectively, might be appropriate.
The <code class="docutils literal notranslate"><span class="pre">IBLPlayer</span></code> class also makes available to its subclasses a suitable value for prepopulated instances and the like for encouraging
exploration, <code class="docutils literal notranslate"><span class="pre">_initial_payoff</span></code>, based on these possible payoff values. In addition, the usual IBL parameters (noise, decay and blending temperature)
can also be modified simply by change parameters passed to the constructor.</p>
<p>The simplest IBL model, <code class="docutils literal notranslate"><span class="pre">BasicIBLPlayer</span></code>,  simply bases its choice on the history of results from having made each move, with no concern for
the moves made in the preceding rounds. This can work against unsophisticated opponents, such as one that favors rock 60% of the time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">rps_game</span><span class="o">.</span><span class="n">py</span> <span class="n">ibl</span><span class="o">.</span><span class="n">BasicIBLPlayer</span> <span class="s2">&quot;rand.RandomPlayer(bias=(0.6, 0.2))&quot;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/rps-4.png"><img alt="_images/rps-4.png" src="_images/rps-4.png" style="width: 700px;" />
</a>
<p>But this basic model is readily defeated by a more sophisticated opponent, such as one employing a win stay, lose shift strategy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">rps_game</span><span class="o">.</span><span class="n">py</span> <span class="n">ibl</span><span class="o">.</span><span class="n">BasicIBLPlayer</span> <span class="s2">&quot;wsls.WinStayLoseShiftPlayer(upgrade=1)&quot;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/rps-5.png"><img alt="_images/rps-5.png" src="_images/rps-5.png" style="width: 700px;" />
</a>
<p>A smarter model can use a PyIBL attribute to base its move selection on the opponents previous move. This does better against
the wind stay, stay loses shift opponent, above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">rps_game</span><span class="o">.</span><span class="n">py</span> <span class="n">ibl</span><span class="o">.</span><span class="n">ContextualIBLPlayer</span> <span class="s2">&quot;wsls.WinStayLoseShiftPlayer(upgrade=1)&quot;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/rps-6.png"><img alt="_images/rps-6.png" src="_images/rps-6.png" style="width: 700px;" />
</a>
<p>But if the win stay, lose shift opponent randomly selects what it does on a loss, the <code class="docutils literal notranslate"><span class="pre">ContextualIBLPlayer</span></code> will fare poorly against it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">rps_game</span><span class="o">.</span><span class="n">py</span> <span class="n">ibl</span><span class="o">.</span><span class="n">ContextualIBLPlayer</span> <span class="s2">&quot;wsls.WinStayLoseShiftPlayer(upgrade=0.5)&quot;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/rps-7.png"><img alt="_images/rps-7.png" src="_images/rps-7.png" style="width: 700px;" />
</a>
<p>To improve this IBL model further we want to have it capture not just the experience of what opponent moves most likely follow its own moves,
but how it responds to our moves. In a <code class="docutils literal notranslate"><span class="pre">LagIBLModel</span></code> we capture the results based on both players’ past moves.
By default it only uses the immediately preceding moves of both players, but by setting the <code class="docutils literal notranslate"><span class="pre">lag</span></code> parameter this can be increased to
multiple past moves.
A full set of results for all pairs of possible moves is large, especially if we consider multiple past moves, we use partial matching
to treat unseen results as of some value, but not as much as one’s we’ve really seen. The similarly function, <code class="docutils literal notranslate"><span class="pre">sim()</span></code>, returns 0.5,
for attributes that do not match instances we’ve seen, allowing instances only some of whose attributes match to still contributed to
the blended value, albeit with less weight than those that have more matching attributes.</p>
<p>With a lag of only one, matching just the preceding moves of both places, this model handily dominates the win stay, lose shift strategy
even with an evenly distributed random selection of upgrades/downgraes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">rps_game</span><span class="o">.</span><span class="n">py</span> <span class="n">ibl</span><span class="o">.</span><span class="n">LagIBLPlayer</span> <span class="s2">&quot;wsls.WinStayLoseShiftPlayer(upgrade=0.5)&quot;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/rps-8.png"><img alt="_images/rps-8.png" src="_images/rps-8.png" style="width: 700px;" />
</a>
<p>Because most of these models, both the conventional ones and the IBL ones, have various parameters that can be modified
it is easy to compare the results of a variety of differing strategies.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2014-2025 Carnegie Mellon University.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/rock-paper-scissors.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>